## Extracted Content from `OWL 19 ORM Service`

This tutorial focuses on the Object-Relational Mapping (ORM) service in OWL components for Odoo 17. The ORM service provides a convenient way to interact with Odoo's backend models directly from the frontend. 

### Understanding the ORM Service in OWL

The ORM service in OWL aims to provide an easy way to access the backend ORM.  It offers a similar level of access as developing an API using Odoo's XML or JSON RPC.  You can use it to perform common database operations and call public methods on any chosen Odoo model. 

Key functionalities of the ORM service:
* **Access to Backend ORM:** It simplifies interaction with Odoo's server-side models from the frontend. 
* **Public Methods Only:** You will only have access to public functions on the model.  Private functions are not accessible. 
* **CRUD Operations:** You can create, delete, or update records. 
* **Calling Public Functions:** You can call any public function on the model of your choosing. 
* **`useService` Hook:** Similar to other services, you consume the ORM service in your OWL components using the `useService` hook, passing `'orm'` as the service name. 

### Implementing the ORM Service in Odoo 17

This exercise demonstrates how to use the ORM service to create a CRM lead record in the Odoo backend from your OWL component.

Assume you have `ExampleComponent` (parent) and `ChildComponent` (child) set up from previous tutorials.

#### Goal: Create a CRM lead when a button is clicked.

1.  **Add `crm` to Module Dependencies (`__manifest__.py`):**
    * To work with CRM models, your module needs to declare a dependency on the `crm` module.
    * Open your module's `__manifest__.py` file and add `'crm'` to the `depends` list.

    ```python
    # my_module/__manifest__.py
    {
        'name': 'My Module',
        'depends': ['base', 'web', 'crm'], # Add 'crm' here
        # ... other manifest fields
    }
    ```

2.  **Consume the ORM Service in `ExampleComponent` (`example.js`):**
    * Open `my_module/static/src/components/example/example.js`.
    * Import `useService` if you haven't already.
    * In the `setup()` method, get an instance of the ORM service using `useService('orm')` and store it on `this.orm`. 
    * Modify your `increment` method (or create a new one, e.g., `createLead`) to use `this.orm.call()`. 
    * The `call` method takes three main arguments:
        1.  The model name (e.g., `'crm.lead'`). 
        2.  The method name to call on the model (e.g., `'create'`). 
        3.  An array of arguments for the method (e.g., `[{ name: 'New Lead from OWL' }]`). 

    ```javascript
    // my_module/static/src/components/example/example.js
    import { Component, useSubEnv } from "@odoo/owl";
    import { ChildComponent } from "../child/child";
    import { useService } from "@web/core/utils/hooks";

    export class ExampleComponent extends Component {
        static template = "my_module.example_owl_template";
        static components = { ChildComponent };

        setup() {
            // Consume the ORM service
            this.orm = useService("orm"); 
            // ... existing setup logic (e.g., counterService, sub-env)
            this.counterService = useService("counter-service");
            useSubEnv({ data: "info" });
        }

        async createCrmLead() { // Use async if you plan to await the ORM call
            try {
                // Call the 'create' method on the 'crm.lead' model
                const newLeadId = await this.orm.call( // Await the asynchronous call
                    "crm.lead", // Model name 
                    "create",   // Method name 
                    [{ name: "New Lead from OWL" }] // Arguments for the 'create' method 
                );
                console.log("New CRM Lead created with ID:", newLeadId);
                // Optionally, add a notification here to confirm creation
                const notification = useService("notification"); // Example of getting notification service
                notification.add("CRM Lead created successfully!", { type: "success" });
            } catch (error) {
                console.error("Error creating CRM lead:", error);
                const notification = useService("notification");
                notification.add("Failed to create CRM Lead: " + error.message, { type: "danger" });
            }
        }

        // Keep existing increment for the counter logic, or modify if combining
        increment() {
             this.counterService.increment(); // Calls the increment from the counter service
        }
    }
    ```

3.  **Modify `ExampleComponent`'s Template (`example.xml`):**
    * Change the `t-on-click` of your button to call the new `createCrmLead` method instead of `increment`. If you want both, add another button.

    ```xml
    <templates>
        <t t-name="my_module.example_owl_template">
            <div>
                <p>Hello Owl</p>
                <button t-on-click="createCrmLead" class="btn btn-info me-2">Create CRM Lead</button>
                <button t-on-click="increment" class="btn btn-primary">Increment Counter</button>
                <hr/>
                <ChildComponent counter="counterService.state.value"/>
            </div>
        </t>
    </templates>
    ```

4.  **Restart Odoo Server and Test:**
    * Restart your Odoo instance. This is crucial for the manifest changes to take effect.
    * Go to any Odoo backend page where your `ExampleComponent` is loaded (e.g., Sales -> Orders).
    * Open your browser's developer console (F12).
    * Click the "Create CRM Lead" button.
    * Check your Odoo backend under CRM -> Leads. You should see new leads named "New Lead from OWL" created each time you click the button.  The console will also log the ID of the newly created lead.

#### Exercise: Get the Latest CRM Lead

Your next simple exercise is to call a public method using the ORM service that retrieves the latest created `crm.lead` record.  You might need to research which Odoo ORM method is suitable for fetching the latest record (e.g., `search_read` with sorting and limit).  You can then display this lead's name in your `ChildComponent`.